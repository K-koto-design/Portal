<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–†–∞–±–æ—á–∏–π –ü–æ—Ä—Ç–∞–ª PRO</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="–ü–æ—Ä—Ç–∞–ª">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/300/shield.png">

    <style>
        :root {
            --bg: #f2f2f7;
            --accent: #007aff;
            --card: #ffffff;
            --text: #1c1c1e;
            --gray: #8e8e93;
            --red: #ff3b30;
            --green: #34c759;
            --blue-light: #e8f0ff;
        }

        body, html { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); height: 100%; }

        .refresh-btn { position: fixed; top: 50px; right: 20px; width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 1000; border: none; font-size: 20px; cursor: pointer; }

        #ios-lock { display: none; padding: 40px 20px; text-align: center; }
        .setup-card { background: white; border-radius: 20px; padding: 20px; text-align: left; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-top: 20px; }
        
        #login-screen { display: flex; flex-direction: column; justify-content: center; padding: 40px; height: 100vh; box-sizing: border-box; }
        input { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 12px; border: 1px solid #ddd; font-size: 16px; box-sizing: border-box; outline: none; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 600; width: 100%; cursor: pointer; }

        #main-app { display: none; padding: 20px; }
        .header { background: var(--card); padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .total-sum { font-size: 28px; font-weight: 800; color: var(--accent); }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab { background: #e5e5ea; padding: 10px 20px; border-radius: 20px; font-size: 14px; white-space: nowrap; cursor: pointer; transition: 0.2s; }
        .tab.active { background: var(--accent); color: white; }

        .item-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #e5e5ea; position: relative; }
        .status { font-size: 12px; font-weight: bold; padding: 4px 8px; border-radius: 6px; display: inline-block; margin-top: 5px; }
        .status-debt { background: #ffebeb; color: var(--red); }
        .status-ok { background: #e8f9ed; color: var(--green); }
        .status-frozen { background: #f2f2f7; color: var(--gray); text-decoration: line-through; }
        .val { font-weight: bold; color: var(--accent); }

        .freeze-btn { float: right; padding: 6px 12px; border-radius: 8px; border: none; font-size: 12px; font-weight: bold; cursor: pointer; }
        .btn-freeze { background: #fef1f1; color: var(--red); }
        .btn-unfreeze { background: var(--blue-light); color: var(--accent); }

        footer { text-align: center; font-size: 10px; color: var(--gray); margin-top: 20px; padding-bottom: 20px; }
    </style>
</head>
<body>

    <button class="refresh-btn" onclick="hardReset()">üîÑ</button>

    <div id="ios-lock">
        <div style="font-size: 50px;">üì≤</div>
        <h2>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h2>
        <p>–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ iPhone –¥–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–∏—Å –Ω–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π.</p>
        <div class="setup-card">
            <p>1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è¬ª</b>.</p>
            <p>2. –í—ã–±–µ—Ä–∏—Ç–µ <b>¬´–ù–∞ —ç–∫—Ä–∞–Ω ‚Äû–î–æ–º–æ–π‚Äú¬ª</b>.</p>
            <p>3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ—è–≤–∏–≤—à–µ–µ—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.</p>
        </div>
    </div>

    <div id="login-screen">
        <h1 style="text-align:center;">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
        <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn" onclick="tryLogin()">–í–æ–π—Ç–∏</button>
        <p id="error" style="color:red; text-align:center; display:none;">–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞</p>
    </div>

    <div id="main-app">
        <div class="header">
            <div style="font-size: 12px; color: var(--gray); text-transform: uppercase;">–û–±—â–∞—è —Å—É–º–º–∞ –∞–∫—Ç–∏–≤–æ–≤</div>
            <div class="total-sum" id="total-display">0 ‚ÇΩ</div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('clients', this)">–ö–ª–∏–µ–Ω—Ç—ã</div>
            <div class="tab" onclick="showTab('loans', this)">–û–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</div>
            <div class="tab" onclick="showTab('assets', this)">–†–µ–µ—Å—Ç—Ä –∫–∞—Ä—Ç</div>
            <div class="tab" onclick="showTab('freeze', this)">‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∫–∞</div>
        </div>

        <div id="content-area"></div>
        
        <footer>
            –í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: 4.2.1 (Persistent)<br>
            –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
        </footer>
    </div>

    <script>
        // --- –ö–û–ù–§–ò–ì –ò –°–û–•–†–ê–ù–ï–ù–ò–ï ---
        const APP_VERSION = "4.2.1";
        const STORAGE_KEY = "portal_frozen_clients";

        function hardReset() {
            const url = new URL(window.location.href);
            url.searchParams.set('reload', Date.now());
            window.location.replace(url.toString());
        }

        const data = {
            clients: [
                { id: 1, name: "–ê—Ä—Ç—ë–º", phone: "+7 (911) 796-15-22", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 2, name: "–î–∞–Ω—è", phone: "+381 (000) 382-75-02", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 3, name: "–ú–∞—Ç–≤–µ–π", phone: "+7 (901) 736-24-15", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 4, name: "–°–≤—è—Ç–æ—Å–ª–∞–≤", phone: "+375 (529) 888-00-88", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 5, name: "–†–æ–º–∞–Ω", phone: "+7 (906) 235-74-33", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 6, name: "–ú–∏—Ö–∞–∏–ª", phone: "+7 (999) 000-11-22", status: "–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å", frozen: false },
                { id: 7, name: "–ê—Ä—Ç—ë–º", phone: "+7 (890) 763-18-90", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 8, name: "–ê–ª–µ–∫—Å–µ–π", phone: "+7 (999) 000-11-22", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 9, name: "–¢–∏–º–æ—Ñ–µ–π", phone: "+7 (902) 871-61-09", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 10, name: "–†–æ–º–∞–Ω", phone: "+7 (918) 246-74-38", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 11, name: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", phone: "+7 (995) 889-31-27", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 12, name: "–ê—Ä—Ç—ë–º", phone: "+0", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 13, name: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", phone: "+0", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 14, name: "–ê—Ä—Ç—ë–º", phone: "+0", status: "–û–±—ã—á–Ω–æ", frozen: false },
                { id: 15, name: "–î–∞–Ω–∏–∏–ª", phone: "+7 (999) 111-00-50", status: "–û–±—ã—á–Ω–æ", frozen: false }
            ],
            loans: [{ holder: "–ú–∏—Ö–∞–∏–ª", amount: 4286 },{ holder: "–°–≤—è—Ç–æ—Å–ª–∞–≤", amount: 20000 }],
            cards: [
                { id: 1, type: "–ú–ò–† *4152", holder: "–ê—Ä—Ç—ë–º" },
                { id: 2, type: "–ú–ò–† *0102", holder: "–î–∞–Ω—è" },
                { id: 3, type: "–ú–ò–† *3321", holder: "–ú–∞—Ç–≤–µ–π" },
                { id: 4, type: "–ú–ò–† *5642", holder: "–°–≤—è—Ç–æ—Å–ª–∞–≤" },
                { id: 5, type: "–ú–ò–† *2212", holder: "–†–æ–º–∞–Ω" },
                { id: 6, type: "–ú–ò–† *4856", holder: "–ú–∏—Ö–∞–∏–ª" },
                { id: 7, type: "–ú–ò–† *8732", holder: "–ê—Ä—Ç—ë–º" },
                { id: 8, type: "–ú–ò–† *9001", holder: "–ê–ª–µ–∫—Å–µ–π" },
                { id: 9, type: "–ú–ò–† *5673", holder: "–¢–∏–º–æ—Ñ–µ–π" },
                { id: 10, type: "–ú–ò–† *7439", holder: "–†–æ–º–∞–Ω" },
                { id: 11, type: "–ú–ò–† *9873", holder: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä" },
                { id: 12, type: "–ú–ò–† *2645", holder: "–ê—Ä—Ç—ë–º" },
                { id: 13, type: "–ú–ò–† *1039", holder: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä" },
                { id: 14, type: "–ú–ò–† *2340", holder: "–ê—Ä—Ç—ë–º" },
                { id: 15, type: "–ú–ò–† *2010", holder: "–î–∞–Ω–∏–∏–ª" }
            ]
        };

        // –ó–ê–ì–†–£–ó–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø –ò–ó –ü–ê–ú–Ø–¢–ò
        function loadFrozenState() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const frozenIds = JSON.parse(saved);
                data.clients.forEach(c => {
                    if (frozenIds.includes(c.id)) c.frozen = true;
                });
            }
        }

        // –°–û–•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –í –ü–ê–ú–Ø–¢–¨
        function saveFrozenState() {
            const frozenIds = data.clients.filter(c => c.frozen).map(c => c.id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(frozenIds));
        }

        function updateSum() {
            const totalSum = data.loans.reduce((acc, curr) => acc + curr.amount, 0);
            document.getElementById('total-display').innerText = totalSum.toLocaleString() + " ‚ÇΩ";
        }

        function tryLogin() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if (u === "Admin" && p === "45621") {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                updateSum();
                showTab('clients', document.querySelector('.tab'));
            } else {
                document.getElementById('error').style.display = 'block';
            }
        }

        function toggleFreeze(id) {
            const client = data.clients.find(c => c.id === id);
            if(client) {
                client.frozen = !client.frozen;
                saveFrozenState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                showTab('freeze', document.querySelectorAll('.tab')[3]);
            }
        }

        function showTab(type, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            
            let html = '';
            if (type === 'clients') {
                data.clients.forEach(c => {
                    const isFrozen = c.frozen;
                    const sClass = isFrozen ? "status-frozen" : (c.status === "–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å" ? "status-debt" : "status-ok");
                    html += `<div class="item-card" style="opacity: ${isFrozen ? '0.6' : '1'}">
                        <b>${c.name} ${isFrozen ? '‚ùÑÔ∏è' : ''}</b><br>
                        <span style="font-size:13px; color:gray">${c.phone}</span><br>
                        <span class="status ${sClass}">${isFrozen ? '–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù' : c.status}</span>
                    </div>`;
                });
            } else if (type === 'loans') {
                data.loans.forEach(l => {
                    html += `<div class="item-card">
                        <div style="font-size:12px; color:gray">–î–µ—Ä–∂–∞—Ç–µ–ª—å:</div>
                        <div>${l.holder}</div>
                        <div class="val" style="margin-top:5px">${l.amount.toLocaleString()} ‚ÇΩ</div>
                    </div>`;
                });
            } else if (type === 'assets') {
                data.cards.forEach(card => {
                    const client = data.clients.find(c => c.name === card.holder);
                    const isFrozen = client ? client.frozen : false;
                    html += `<div class="item-card" style="opacity: ${isFrozen ? '0.5' : '1'}">
                        <b>${card.type}</b> ${isFrozen ? 'üî¥' : 'üü¢'}<br>
                        <div style="font-size:13px; color:gray">–î–µ—Ä–∂–∞—Ç–µ–ª—å: ${card.holder}</div>
                        <div style="font-size:11px; color:${isFrozen ? 'red' : 'green'}">${isFrozen ? '–ö–∞—Ä—Ç–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞' : '–ö–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞'}</div>
                    </div>`;
                });
            } else if (type === 'freeze') {
                html += '<p style="font-size:12px; color:gray; margin-left:5px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å—á–µ—Ç–∞–º:</p>';
                data.clients.forEach(c => {
                    html += `<div class="item-card">
                        <button class="freeze-btn ${c.frozen ? 'btn-unfreeze' : 'btn-freeze'}" onclick="toggleFreeze(${c.id})">
                            ${c.frozen ? '–†–ê–ó–ú–û–†–û–ó–ò–¢–¨' : '–ó–ê–ú–û–†–û–ó–ò–¢–¨'}
                        </button>
                        <b>${c.name}</b><br>
                        <span style="font-size:12px; color:gray">ID: 00${c.id}</span>
                    </div>`;
                });
            }
            document.getElementById('content-area').innerHTML = html;
        }

        function init() {
            loadFrozenState(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏

            const isStandalone = window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

            if (isIOS && !isStandalone) {
                document.getElementById('ios-lock').style.display = 'block';
                document.getElementById('login-screen').style.display = 'none';
                document.querySelector('.refresh-btn').style.display = 'none';
            }
        }

        window.onload = init;
    </script>
</body>
</html>
