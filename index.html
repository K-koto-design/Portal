<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAX STAFF - –°–∏—Å—Ç–µ–º–∞ –†–∞–ø–æ—Ä—Ç–æ–≤</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #0a0a0a; --card: #1c1c1e; --blue: #0077ff; --text: #fff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }
        .client-card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--blue); }
        .report-btn { background: var(--blue); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }
        #report-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); padding: 20px; z-index: 1000; }
        .modal-content { background: var(--card); padding: 20px; border-radius: 15px; max-width: 400px; margin: 50px auto; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #2c2c2e; color: white; box-sizing: border-box; }
    </style>
</head>
<body>
    <h2>üë®‚Äçüíª –ü–∞–Ω–µ–ª—å –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
    <div id="clients-list">–ü–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π...</div>

    <div id="report-modal">
        <div class="modal-content">
            <h3>üìù –°–æ–∑–¥–∞—Ç—å —Ä–∞–ø–æ—Ä—Ç</h3>
            <input type="text" id="staff-name" placeholder="–í–∞—à–µ –∏–º—è">
            <input type="text" id="target-client" readonly>
            <textarea id="report-desc" rows="4" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å? (–ù–∞–ø—Ä: –ù–∞—á–∏—Å–ª–∏—Ç—å 1000—Ä –∑–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)"></textarea>
            <button class="report-btn" onclick="submitReport()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –í–ª–∞–¥–µ–ª—å—Ü—É</button>
            <button onclick="closeReport()" style="background:none; border:none; color:gray; width:100%; margin-top:10px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg",
            databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "webapp-b7149",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function loadClients() {
            db.ref('clients').on('value', snap => {
                const list = document.getElementById('clients-list');
                list.innerHTML = "";
                if (!snap.exists()) { list.innerHTML = "–ö–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç"; return; }
                
                snap.forEach(child => {
                    const c = child.val();
                    const card = document.createElement('div');
                    card.className = 'client-card';
                    card.innerHTML = `
                        <b>üë§ ${c.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</b><br>
                        <small>ID: ${child.key}</small><br>
                        <p>üí∞ –ë–∞–ª–∞–Ω—Å: ${c.balance || 0} ‚ÇΩ | üéÅ –ë–æ–Ω—É—Å—ã: ${c.bonuses || 0}</p>
                        <button class="report-btn" onclick="openReport('${child.key}', '${c.name}')">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ</button>
                    `;
                    list.appendChild(card);
                });
            });
        }

        function openReport(id, name) {
            document.getElementById('target-client').value = name + " (ID: " + id + ")";
            window.currentClientId = id;
            document.getElementById('report-modal').style.display = 'block';
        }

        function closeReport() { document.getElementById('report-modal').style.display = 'none'; }

        async function submitReport() {
            const staff = document.getElementById('staff-name').value;
            const desc = document.getElementById('report-desc').value;
            if(!staff || !desc) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É!");

            await db.ref('reports').push({
                staff, client: document.getElementById('target-client').value,
                desc, time: new Date().toLocaleString()
            });
            alert("–†–∞–ø–æ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
            closeReport();
        }
        loadClients();
    </script>
</body>
</html>
